% Remember to use the lgrind style

\Head{}
\File{lookupClient.cpp}{2004}{9}{26}{19:49}{8338}
\L{\LB{\C{}/*}}
\L{\LB{}\Tab{2}{lookupClient.cpp}}
\L{\LB{}}
\L{\LB{}\Tab{2}{Alpha_Chen}}
\L{\LB{}\Tab{2}{ECE_4564_Project_1}}
\L{\LB{}\Tab{2}{2004-09-26}}
\L{\LB{}}
\L{\LB{}\Tab{2}{This_program_implements_the_client_side_of_the_lookup_protocol.}}
\L{\LB{}}
\L{\LB{}\Tab{2}{usage:_lookupClient.exe_[host_[port]]}}
\L{\LB{}}
\L{\LB{}\Tab{2}{This_defaults_to_localhost:4564}}
\L{\LB{*/\CE{}}}
\L{\LB{}}
\L{\LB{\K{\#include}_\<\V{winsock}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{iostream}\>}}
\L{\LB{}}
\L{\LB{\C{}//_Required_for_WSAStartup\CE{}}}
\L{\LB{\K{\#define}}\Tab{8}{\V{WSVERS}}\Tab{16}{\V{MAKEWORD}(\N{2},_\N{0})}}
\L{\LB{}}
\L{\LB{\K{using}_\K{namespace}_\V{std};}}
\L{\LB{}}
\L{\LB{\K{void}_\V{init}(\K{struct}_\V{sockaddr\_in}_\&\V{sin},_\K{char}_*\V{host},_\K{int}_\V{port});}}
\L{\LB{\K{int}_\V{parseCommand}(\K{char}_*\V{op},_\K{char}_*\V{sendString});}}
\L{\LB{\K{int}_\V{getInput}(\K{char}_*\V{input});}}
\L{\LB{\K{void}_\V{strcat2}(\K{char}_*\V{a},_\K{char}_*\V{b},_\K{char}_*\V{c});}}
\L{\LB{\K{int}_\V{sendCommand}(\K{struct}_\V{sockaddr\_in}_\&\V{sin},_\K{char}_*\V{response},_\K{char}_*\V{host});}}
\L{\LB{\K{void}_\V{getResponse}(\K{int}_\V{s},_\K{char}_*\V{response});}}
\L{\LB{\K{void}_\V{getAllResponse}(\K{int}_\V{s});}}
\L{\LB{\K{int}_\V{printAll}(\K{char}_*\V{response},_\K{int}_\V{flag});}}
\L{\LB{\K{void}_\V{outputResponse}(\K{char}_*\V{op},_\K{char}_*\V{response});}}
\L{\LB{\K{void}_\V{errexit}(\K{const}_\K{char}_*\V{format},_.\,.\,.);}}
\L{\LB{}}
\index{main}\Proc{main}\L{\LB{\K{int}_\V{main}(\K{int}_\V{argc},_\K{char}_*\V{argv}[\,])_\{}}
\L{\LB{}\Tab{8}{\K{char}_*\V{host};}}
\L{\LB{}\Tab{8}{\K{int}_\V{port}_=_\N{4564};}}
\L{\LB{}\Tab{8}{}}
\L{\LB{}\Tab{8}{\C{}//_Populate_the_hostname_and_port_number_if\CE{}}}
\L{\LB{}\Tab{8}{\C{}//_given_in_the_arguments\CE{}}}
\L{\LB{}\Tab{8}{\K{switch}(\V{argc})_\{}}
\L{\LB{}\Tab{8}{\K{case}_\N{1}\V{:}}}
\L{\LB{}\Tab{16}{\V{host}_=_\S{}\3localhost\3\SE{};}}
\L{\LB{}\Tab{16}{\K{break};}}
\L{\LB{}\Tab{8}{\K{case}_\N{3}\V{:}}}
\L{\LB{}\Tab{16}{\V{port}_=_\V{atoi}(\V{argv}[\N{2}]);}}
\L{\LB{}\Tab{8}{\K{case}_\N{2}\V{:}}}
\L{\LB{}\Tab{16}{\V{host}_=_\V{argv}[\N{1}];}}
\L{\LB{}\Tab{16}{\K{break};}}
\L{\LB{}\Tab{8}{\V{default:}}}
\L{\LB{}\Tab{16}{\V{fprintf}(\V{stderr},_\S{}\3usage:_lookup_[host_[port]]\2n\3\SE{});}}
\L{\LB{}\Tab{16}{\V{exit}(\N{1});}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\C{}//_Remote_machine_endpoint_structure\CE{}}}
\L{\LB{}\Tab{8}{\K{struct}_\V{sockaddr\_in}_\V{sin};}}
\L{\LB{}\Tab{8}{\V{init}(\V{sin},_\V{host},_\V{port});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\C{}//_Socket_descriptor\CE{}}}
\L{\LB{}\Tab{8}{\K{int}_\V{s};}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\K{char}_*\V{op}_=_\K{new}_\K{char}[\N{10}],_*\V{response}_=_\K{new}_\K{char}[\N{1024}];}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{while}_(\N{1})_\{}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\S{}\3Operation_(PUT,_GET,_CLR,_ALL,_or_QUIT)?_\3\SE{};}}
\L{\LB{}\Tab{16}{\V{cin}.\V{getline}(\V{op},_\N{10});}}
\L{\LB{}}
\L{\LB{}\Tab{16}{\C{}//_Finish,_gracefully_clean_up\CE{}}}
\L{\LB{}\Tab{16}{\K{if}(!\V{strcmp}(\V{op},_\S{}\3QUIT\3\SE{}))_\{}}
\L{\LB{}\Tab{24}{\V{WSACleanup}();}}
\L{\LB{}\Tab{24}{\K{return}_\N{0};}}
\L{\LB{}\Tab{16}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{16}{\C{}//_parseCommand_returns_the_request_to_be_sent\CE{}}}
\L{\LB{}\Tab{16}{\C{}//_to_the_server_in_response\CE{}}}
\L{\LB{}\Tab{16}{\K{if}(\V{parseCommand}(\V{op},_\V{response}))_\{}}
\L{\LB{}\Tab{24}{\V{s}_=_\V{sendCommand}(\V{sin},_\V{response},_\V{host});}}
\L{\LB{}}
\L{\LB{}\Tab{24}{\K{if}(\V{strcmp}(\V{op},_\S{}\3ALL\3\SE{}))_\{}}
\L{\LB{}\Tab{32}{\V{getResponse}(\V{s},_\V{response});}}
\L{\LB{}}
\L{\LB{}\Tab{32}{\C{}//_Check_for_a_recognizeable\CE{}}}
\L{\LB{}\Tab{32}{\C{}//_response_from_the_server\CE{}}}
\L{\LB{}\Tab{32}{\K{if}(\V{strlen}(\V{response}))}}
\L{\LB{}\Tab{40}{\V{outputResponse}(\V{op},_\V{response});}}
\L{\LB{}\Tab{32}{\K{else}}}
\L{\LB{}\Tab{40}{\V{cout}\<\<\S{}\3Unrecognized_response_from_server:_\3\SE{}}}
\L{\LB{}\Tab{48}{\<\<\V{response}\<\<\V{endl};}}
\L{\LB{}\Tab{24}{\}}}
\L{\LB{}\Tab{24}{\K{else}}}
\L{\LB{}\Tab{32}{\V{getAllResponse}(\V{s});}}
\L{\LB{}\Tab{24}{}}
\L{\LB{}\Tab{24}{\V{closesocket}(\V{s});}}
\L{\LB{}\Tab{16}{\}}}
\L{\LB{}\Tab{16}{\K{else}_\C{}//_if_parseCommand_returns_0\CE{}}}
\L{\LB{}\Tab{24}{\V{cout}\<\<\S{}\3Invalid_command.\3\SE{}\<\<\V{endl};}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{\}}}
\L{\LB{}}
\index{init}\Proc{init}\L{\LB{\K{void}_\V{init}(\K{struct}_\V{sockaddr\_in}_\&\V{sin},_\K{char}_*\V{host},_\K{int}_\V{port})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Initializes_the_networking._Takes_the_endpoint_structure,}}
\L{\LB{}\Tab{11}{a_hostname,_and_a_port_number._The_endpoint_structure_is}}
\L{\LB{}\Tab{11}{passed_by_reference_and_populated_in_this_function.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\V{WSADATA}_\V{wsadata};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{if}_(\V{WSAStartup}(\V{WSVERS},_\&\V{wsadata})_!=_\N{0})}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3WSAStartup_failed\2n\3\SE{});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{memset}(\&\V{sin},_\N{0},_\K{sizeof}(\V{sin}));}}
\L{\LB{}\Tab{8}{\V{sin}.\V{sin\_family}_=_\V{AF\_INET};}}
\L{\LB{}\Tab{8}{\V{sin}.\V{sin\_port}_=_\V{htons}(\V{port});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{struct}_\V{hostent}}\Tab{24}{*\V{phe};}\Tab{40}{\C{}/*_pointer_to_host_information_entry_*/\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{4}{\C{}/*_Map_host_name_to_IP_address,_allowing_for_dotted_decimal_*/\CE{}}}
\L{\LB{}\Tab{8}{\K{if}_(_\V{phe}_=_\V{gethostbyname}(\V{host})_)}}
\L{\LB{}\Tab{16}{\V{memcpy}(\&\V{sin}.\V{sin\_addr},_\V{phe}\-\!\>\V{h\_addr},_\V{phe}\-\!\>\V{h\_length});}}
\L{\LB{}\Tab{8}{\K{else}_\K{if}}\Tab{16}{(_(\V{sin}.\V{sin\_addr}.\V{s\_addr}_=_\V{inet\_addr}(\V{host}))_==_\V{INADDR\_NONE})}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3can{'}t_get_\2\3\%s\2\3_host_entry\2n\3\SE{},_\V{host});}}
\L{\LB{}}
\L{\LB{\}}}
\L{\LB{}}
\index{parseCommand}\Proc{parseCommand}\L{\LB{\K{int}_\V{parseCommand}(\K{char}_*\V{op},_\K{char}_*\V{sendString})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Parses_the_command_in_op,_getting_data}}
\L{\LB{}\Tab{11}{from_the_user_if_necessary,_and_creating}}
\L{\LB{}\Tab{11}{the_request_to_the_server_in_sendString.}}
\L{\LB{}}
\L{\LB{}\Tab{11}{Uses_getInput_to_make_sure_the_key_and}}
\L{\LB{}\Tab{11}{value_are_at_most_64_characters_long.}}
\L{\LB{}}
\L{\LB{}\Tab{11}{Uses_strcat2_to_concatenate_three_strings}}
\L{\LB{}\Tab{11}{at_once.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\K{char}_*\V{input}_=_\K{new}_\K{char}[\N{1024}];}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\C{}//_The_request_always_begins_with\CE{}}}
\L{\LB{}\Tab{8}{\C{}//_the_operation_to_be_performed.\CE{}}}
\L{\LB{}\Tab{8}{\V{strcpy}(\V{sendString},_\V{op});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{if}(!\V{strcmp}(\V{op},_\S{}\3PUT\3\SE{}))_\{}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\S{}\3Key?_\3\SE{};}}
\L{\LB{}\Tab{16}{\K{if}(!\V{getInput}(\V{input}))_\K{return}_\N{0};}}
\L{\LB{}\Tab{16}{\V{strcat2}(\V{sendString},_\S{}\3_\3\SE{},_\V{input});}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\S{}\3Value?_\3\SE{};}}
\L{\LB{}\Tab{16}{\K{if}(!\V{getInput}(\V{input}))_\K{return}_\N{0};}}
\L{\LB{}\Tab{16}{\V{strcat2}(\V{sendString},_\S{}\3,\3\SE{},_\V{input});}}
\L{\LB{}\Tab{16}{\K{return}_\N{1};}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}\Tab{8}{\K{else}_\K{if}(!\V{strcmp}(\V{op},_\S{}\3GET\3\SE{}))_\{}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\S{}\3Key?_\3\SE{};}}
\L{\LB{}\Tab{16}{\K{if}(!\V{getInput}(\V{input}))_\K{return}_\N{0};}}
\L{\LB{}\Tab{16}{\V{strcat2}(\V{sendString},_\S{}\3_\3\SE{},_\V{input});}}
\L{\LB{}\Tab{16}{\K{return}_\N{1};}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}\Tab{8}{\K{else}_\K{if}(!\V{strcmp}(\V{op},_\S{}\3CLR\3\SE{}))_\{}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\S{}\3Key?_\3\SE{};}}
\L{\LB{}\Tab{16}{\K{if}(!\V{getInput}(\V{input}))_\K{return}_\N{0};}}
\L{\LB{}\Tab{16}{\V{strcat2}(\V{sendString},_\S{}\3_\3\SE{},_\V{input});}}
\L{\LB{}\Tab{16}{\K{return}_\N{1};}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}\Tab{8}{\K{else}_\K{if}(!\V{strcmp}(\V{op},_\S{}\3ALL\3\SE{}))_\K{return}_\N{1};}}
\L{\LB{}\Tab{8}{\K{else}_\K{return}_\N{0};}}
\L{\LB{\}}}
\L{\LB{}}
\index{getInput}\Proc{getInput}\L{\LB{\K{int}_\V{getInput}(\K{char}_*\V{input})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Gets_input_from_the_command_line,}}
\L{\LB{}\Tab{11}{making_sure_that_it_is_at_most_64}}
\L{\LB{}\Tab{11}{characters_long_and_does_not_contain}}
\L{\LB{}\Tab{11}{any_commas._Returns_0_on_failure_and}}
\L{\LB{}\Tab{11}{1_on_success.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\V{cin}.\V{getline}(\V{input},_\N{1024});}}
\L{\LB{}\Tab{8}{\K{if}(\V{strlen}(\V{input})_\>_\N{64})_\{}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\S{}\3Key_length_can_be_at_most_64_bytes.\3\SE{}\<\<\V{endl};}}
\L{\LB{}\Tab{16}{\K{return}_\N{0};}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}\Tab{8}{\K{else}_\K{if}(\V{strchr}(\V{input},_\S{}{'},{'}\SE{}))_\{}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\S{}\3Commas_cannot_be_used_as_a_key_or_value.\3\SE{}\<\<\V{endl};}}
\L{\LB{}\Tab{16}{\K{return}_\N{0};}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{return}_\N{1};}}
\L{\LB{\}}}
\L{\LB{}}
\index{strcat2}\Proc{strcat2}\L{\LB{\K{void}_\V{strcat2}(\K{char}_*\V{a},_\K{char}_*\V{b},_\K{char}_*\V{c})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Concatenates_three_strings.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\V{a}_=_\V{strcat}(\V{a},_\V{b});}}
\L{\LB{}\Tab{8}{\V{a}_=_\V{strcat}(\V{a},_\V{c});}}
\L{\LB{\}}}
\L{\LB{}}
\index{sendCommand}\Proc{sendCommand}\L{\LB{\K{int}_\V{sendCommand}(\K{struct}_\V{sockaddr\_in}_\&\V{sin},_\K{char}_*\V{response},_\K{char}_*\V{host})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Creates_a_socket_with_the_endpoint_address_given_in_the}}
\L{\LB{}\Tab{11}{arguments_and_then_sends_the_response_string_to_the_server.}}
\L{\LB{}}
\L{\LB{}\Tab{11}{The_host_argument_is_given_in_case_of_an_error_in_connecting}}
\L{\LB{}\Tab{11}{the_socket.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\C{}/*_Allocate_a_socket_*/\CE{}}}
\L{\LB{}\Tab{8}{\K{int}_\V{s}_=_\V{socket}(\V{PF\_INET},_\V{SOCK\_STREAM},_\N{0});}}
\L{\LB{}\Tab{8}{\K{if}_(\V{s}_==_\V{INVALID\_SOCKET})}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3can{'}t_create_socket:_\%d\2n\3\SE{},_\V{GetLastError}());}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\C{}/*_Connect_the_socket_*/\CE{}}}
\L{\LB{}\Tab{8}{\K{if}_(\V{connect}(\V{s},_(\K{struct}_\V{sockaddr}_*)\&\V{sin},_\K{sizeof}(\V{sin}))_==_\V{SOCKET\_ERROR})}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3can{'}t_connect_to_\%s:_\%d\2n\3\SE{},_\V{host},_\V{GetLastError}());}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\C{}/*_Send_the_string_*/\CE{}}}
\L{\LB{}\Tab{8}{\K{if}(\V{send}(\V{s},_\V{response},_\V{strlen}(\V{response}),_\N{0})_==_\V{SOCKET\_ERROR})}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3couldn{'}t_send_\%s:_\%d\2n\3\SE{},_\V{response},_\V{GetLastError}());}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\C{}/*_Start_the_shutdown_sequence_*/\CE{}}}
\L{\LB{}\Tab{8}{\K{if}(\V{shutdown}(\V{s},\N{1})_==_\V{SOCKET\_ERROR})}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3shutdown_error:_\%d\2n\3\SE{},_\V{GetLastError}());}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{return}_\V{s};}}
\L{\LB{\}}}
\L{\LB{}}
\index{getResponse}\Proc{getResponse}\L{\LB{\K{void}_\V{getResponse}(\K{int}_\V{s},_\K{char}_*\V{response})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Get_the_response_from_the_server_using}}
\L{\LB{}\Tab{11}{the_socket_s,_placing_it_in_the_string}}
\L{\LB{}\Tab{11}{response.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\K{int}_\V{buflen}_=_\N{1024};}}
\L{\LB{}\Tab{8}{\K{char}_*\V{bufptr}_=_\V{response};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{int}_\V{n}_=_\V{recv}(\V{s},_\V{bufptr},_\V{buflen},_\N{0});}}
\L{\LB{}\Tab{24}{}}
\L{\LB{}\Tab{8}{\K{while}(\V{n}_!=_\V{SOCKET\_ERROR}_\&\&_\V{n}_!=_\N{0})_\{}}
\L{\LB{}\Tab{16}{\V{bufptr}_=_\V{bufptr}_+_\V{n};}}
\L{\LB{}\Tab{16}{\V{buflen}_=_\V{buflen}_\-_\V{n};}}
\L{\LB{}\Tab{16}{\V{n}_=_\V{recv}(\V{s},_\V{bufptr},_\V{buflen},_\N{0});}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}\Tab{8}{}}
\L{\LB{}\Tab{8}{\K{if}(\V{n}_==_\V{SOCKET\_ERROR})}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3receiving_error:_\%d\2n\3\SE{},_\V{GetLastError}());}}
\L{\LB{}\Tab{8}{}}
\L{\LB{}\Tab{8}{\C{}//_Make_sure_there_is_a_null_character_at\CE{}}}
\L{\LB{}\Tab{8}{\C{}//_the_end_of_the_string.\CE{}}}
\L{\LB{}\Tab{8}{*\V{bufptr}_=_\S{}{'}\20{'}\SE{};}}
\L{\LB{\}}}
\L{\LB{}}
\index{getAllResponse}\Proc{getAllResponse}\L{\LB{\K{void}_\V{getAllResponse}(\K{int}_\V{s})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_The_response_from_the_server_for_the}}
\L{\LB{}\Tab{11}{ALL_command_may_not_fit_into_the_buffer,}}
\L{\LB{}\Tab{11}{so_it_needs_to_be_processed_on_the_fly.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\K{int}_\V{buflen}_=_\N{1024},_\V{flag}_=_\N{0};}}
\L{\LB{}\Tab{8}{\K{char}_*\V{response}_=_\K{new}_\K{char}[\V{buflen}];}}
\L{\LB{}\Tab{8}{\K{char}_*\V{bufptr}_=_\V{response};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{int}_\V{n}_=_\V{recv}(\V{s},_\V{bufptr},_\V{buflen},_\N{0});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{while}(\V{n}_!=_\V{SOCKET\_ERROR}_\&\&_\V{n}_!=_\N{0})_\{}}
\L{\LB{}\Tab{16}{\V{bufptr}_=_\V{bufptr}_+_\V{n};}}
\L{\LB{}\Tab{16}{\V{buflen}_=_\V{buflen}_\-_\V{n};}}
\L{\LB{}}
\L{\LB{}\Tab{16}{\C{}//_Untested_code_for_handling\CE{}}}
\L{\LB{}\Tab{16}{\C{}//_lookup_tables_with_more_than\CE{}}}
\L{\LB{}\Tab{16}{\C{}//_1024_characters:\CE{}}}
\L{\LB{}\Tab{16}{\K{if}(\V{buflen}_\<_\N{512})_\{}}
\L{\LB{}\Tab{24}{*\V{bufptr}_=_\S{}{'}\20{'}\SE{};}}
\L{\LB{}\Tab{24}{\V{flag}_=_\V{printAll}(\V{response},_\V{flag});}}
\L{\LB{}\Tab{24}{\V{buflen}_=_\N{1024};}}
\L{\LB{}\Tab{24}{\V{bufptr}_=_\V{response};}}
\L{\LB{}\Tab{16}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{16}{\V{n}_=_\V{recv}(\V{s},_\V{bufptr},_\V{buflen},_\N{0});}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{8}{*\V{bufptr}_=_\S{}{'}\20{'}\SE{};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{printAll}(\V{response},_\V{flag});}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{cout}\<\<\V{endl};}}
\L{\LB{}\Tab{8}{}}
\L{\LB{}\Tab{8}{\K{if}(\V{n}_==_\V{SOCKET\_ERROR})}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3receiving_error:_\%d\2n\3\SE{},_\V{GetLastError}());}}
\L{\LB{\}}}
\L{\LB{}}
\index{printAll}\Proc{printAll}\L{\LB{\K{int}_\V{printAll}(\K{char}_*\V{response},_\K{int}_\V{flag})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Handles_printing_for_the_ALL_command.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\K{if}(!\V{flag})_\{}}
\L{\LB{}\Tab{16}{\K{char}_*_\V{strptr}_=_\V{strtok}(\V{response},_\S{}\3_\3\SE{});}}
\L{\LB{}\Tab{16}{\K{if}(!\V{strcmp}(\V{strptr},_\S{}\3OK\3\SE{}))_\{}}
\L{\LB{}\Tab{24}{\V{flag}_=_\N{1};}}
\L{\LB{}\Tab{24}{\V{cout}\<\<\S{}\3Request_was_successful.\3\SE{}\<\<\V{endl}}}
\L{\LB{}\Tab{32}{\<\<\S{}\3All_key\-value_pairs_follow:\3\SE{}\<\<\V{endl}\<\<\V{endl}}}
\L{\LB{}\Tab{32}{\<\<\V{strptr}_+_\V{strlen}(\V{strptr})_+_\N{1};}}
\L{\LB{}\Tab{16}{\}}}
\L{\LB{}\Tab{16}{\K{else}_\{}}
\L{\LB{}\Tab{24}{\V{flag}_=_\N{0};}}
\L{\LB{}\Tab{24}{\V{cout}\<\<\S{}\3Request_failed:_\3\SE{}\<\<\V{strptr}+\N{6}\<\<\V{endl};}}
\L{\LB{}\Tab{16}{\}}}
\L{\LB{}\Tab{8}{\}}}
\L{\LB{}\Tab{8}{\K{else}}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\V{response};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\K{return}_\V{flag};}}
\L{\LB{\}}}
\L{\LB{}}
\index{outputResponse}\Proc{outputResponse}\L{\LB{\K{void}_\V{outputResponse}(\K{char}_*\V{op},_\K{char}_*\V{response})_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Parse_the_string_response_containing_the}}
\L{\LB{}\Tab{11}{response_from_the_server._op_is_passed_to}}
\L{\LB{}\Tab{11}{make_decisions_about_parsing_the_response.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\C{}//_Start_tokenizing_the_string;_this_first\CE{}}}
\L{\LB{}\Tab{8}{\C{}//_one_grabs_the_OK_or_ERROR_flag.\CE{}}}
\L{\LB{}\Tab{8}{\K{char}_*\V{strptr}_=_\V{strtok}(\V{response},_\S{}\3_\3\SE{});}}
\L{\LB{}\Tab{8}{}}
\L{\LB{}\Tab{8}{\K{if}(!\V{strcmp}(\V{strptr},_\S{}\3OK\3\SE{}))}}
\L{\LB{}\Tab{16}{\K{if}(\V{strcmp}(\V{op},_\S{}\3GET\3\SE{}))_\{_\C{}//_if_the_request_was_not_a_GET\CE{}}}
\L{\LB{}\Tab{24}{\V{cout}\<\<\S{}\3Request_was_successful.\3\SE{}\<\<\V{endl};}}
\L{\LB{}\Tab{24}{\K{if}(!\V{strcmp}(\V{op},_\S{}\3ALL\3\SE{}))}}
\L{\LB{}\Tab{32}{\C{}//_Print_out_all_key-value_pairs\CE{}}}
\L{\LB{}\Tab{32}{\C{}//_on_an_ALL_operation.\CE{}}}
\L{\LB{}\Tab{32}{\V{cout}\<\<\S{}\3All_key\-value_pairs_follow:\3\SE{}\<\<\V{endl}\<\<\V{endl}}}
\L{\LB{}\Tab{40}{\<\<\V{strptr}_+_\V{strlen}(\V{strptr})_+_\N{1}\<\<\V{endl};}}
\L{\LB{}\Tab{16}{\}}}
\L{\LB{}\Tab{16}{\K{else}_\{_\C{}//_the_request_was_a_GET\CE{}}}
\L{\LB{}\Tab{24}{\C{}//_Tokenize_on_the_comma_separating_the\CE{}}}
\L{\LB{}\Tab{24}{\C{}//_key_and_value.\CE{}}}
\L{\LB{}\Tab{24}{\V{strptr}_=_\V{strtok}(\V{NULL},_\S{}\3,\3\SE{});}}
\L{\LB{}\Tab{24}{\V{cout}\<\<\S{}\3Returned_value_for_key_\2\3\3\SE{}\<\<\V{strptr}\<\<\S{}\3\2\3:_\3\SE{}}}
\L{\LB{}\Tab{32}{\<\<\V{strptr}_+_\V{strlen}(\V{strptr})_+_\N{1}\<\<\V{endl};}}
\L{\LB{}\Tab{16}{\}}}
\L{\LB{}\Tab{8}{\K{else}_\K{if}(!\V{strcmp}(\V{strptr},_\S{}\3ERROR\3\SE{}))}}
\L{\LB{}\Tab{16}{\C{}//_On_an_ERROR,_print_out_the_server_response.\CE{}}}
\L{\LB{}\Tab{16}{\V{cout}\<\<\S{}\3Request_failed:_\3\SE{}\<\<\V{strptr}+\N{6}\<\<\V{endl};}}
\L{\LB{}\Tab{8}{\K{else}_\C{}//_the_server_did_not_return_an_OK_or_an_ERROR\CE{}}}
\L{\LB{}\Tab{16}{\V{errexit}(\S{}\3unknown_response_from_server:_\%s\2n\3\SE{},_\V{response});}}
\L{\LB{\}}}
\L{\LB{}}
\index{errexit}\Proc{errexit}\L{\LB{\K{void}_\V{errexit}(\K{const}_\K{char}_*\V{format},_.\,.\,.)_\{}}
\L{\LB{}\Tab{8}{\C{}/*_Error_handling;_prints_an_error}}
\L{\LB{}\Tab{11}{message_from_the_arguments,_cleans}}
\L{\LB{}\Tab{11}{up_the_networking,_and_exits_the}}
\L{\LB{}\Tab{11}{program.}}
\L{\LB{}\Tab{8}{*/\CE{}}}
\L{\LB{}\Tab{8}{\V{va\_list}}\Tab{16}{\V{args};}}
\L{\LB{}}
\L{\LB{}\Tab{8}{\V{va\_start}(\V{args},_\V{format});}}
\L{\LB{}\Tab{8}{\V{vfprintf}(\V{stderr},_\V{format},_\V{args});}}
\L{\LB{}\Tab{8}{\V{va\_end}(\V{args});}}
\L{\LB{}\Tab{8}{\V{WSACleanup}();}}
\L{\LB{}\Tab{8}{\V{exit}(\N{1});}}
\L{\LB{\}}}
