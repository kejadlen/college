% Remember to use the lgrind style

\Head{}
\File{assign.c}{2005}{5}{5}{20:44}{7544}
\L{\LB{\K{\#include}_\<\V{stdio}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{cyg}/\V{hal}/\V{hal\_diag}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{cyg}/\V{hal}/\V{hal\_intr}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{cyg}/\V{infra}/\V{diag}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{cyg}/\V{infra}/\V{cyg\_type}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{cyg}/\V{hal}/\V{drv\_api}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{parts}/\V{m55800}/\V{lib\_m55800}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{parts}/\V{m55800}/\V{reg\_m55800}.\V{h}\>}}
\L{\LB{\K{\#include}_\<\V{targets}/\V{eb55}/\V{eb55}.\V{h}\>}}
\L{\LB{}}
\L{\LB{\C{}/*}}
\L{\LB{_train\_init.c_has_all_of_the_state_table_specifics}}
\L{\LB{_}}
\L{\LB{_The_following_functions_are_used_to_interface_with}}
\L{\LB{_the_state_table,_for_modularity:}}
\L{\LB{_}}
\L{\LB{_update\_sensor(int_id,_int_state);}}
\L{\LB{}\Tab{2}{id:}\Tab{10}{sensor_id}}
\L{\LB{}\Tab{2}{state:}\Tab{10}{0_-\!\>_off,_1_-\!\>_on}}
\L{\LB{_update\_switch(int_id,_int_state);}}
\L{\LB{}\Tab{2}{id:}\Tab{10}{switch_id}}
\L{\LB{}\Tab{2}{state:}\Tab{10}{0_-\!\>_thrown,_1_-\!\>_closed}}
\L{\LB{_update\_train(int_slot,_int_direction);}}
\L{\LB{}\Tab{2}{slot:}\Tab{10}{train_slot_id}}
\L{\LB{}\Tab{2}{state:}\Tab{10}{0_-\!\>_backwards,_1_-\!\>_forwards}}
\L{\LB{_*/\CE{}}}
\L{\LB{\K{\#include}_\S{}\3train\_init.c\3\SE{}}}
\L{\LB{}}
\L{\LB{\K{static}_\V{u\_int}_\V{timer\_counter};}}
\L{\LB{\K{static}_\V{u\_int}_\V{clock\_select};}}
\L{\LB{}}
\L{\LB{\V{volatile}_\V{read\_buffer}[\N{0xFF}];}}
\L{\LB{\V{u\_int}_\V{x}_=_\N{0};}}
\L{\LB{}}
\index{usart\_read}\Proc{usart\_read}\L{\LB{\V{cyg\_uint32}_\V{usart\_read}(_\V{cyg\_vector\_t}_\V{vector},_\V{cyg\_addrword\_t}_\V{data}_)_\{}}
\L{\LB{}\Tab{2}{\C{}/*}}
\L{\LB{}\Tab{3}{Interrupt_service_routine_for_USART_receive._This_gets_the_current_byte}}
\L{\LB{}\Tab{3}{on_the_line_and_places_it_into_the_buffer._Every_time_a_byte_is_received,}}
\L{\LB{}\Tab{3}{we_check_the_buffer_for_a_complete_packet_and_modify_the_state_table_}}
\L{\LB{}\Tab{3}{using_the_update\_X()_functions_if_required.}}
\L{\LB{}\Tab{3}{*/\CE{}}}
\L{\LB{}\Tab{2}{\V{UsartDesc}_*\V{usart}_=_\&(\V{USART1\_DESC});}}
\L{\LB{}\Tab{2}{\V{u\_int}_\V{in1},_\V{in2},_\V{object\_id},_\V{object\_state};}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{at91\_usart\_read}(\V{usart},_\&\V{read\_buffer}[\V{x}]);}\Tab{44}{//_\V{Get}_\V{the}_\V{byte}_\V{from}_\V{the}_\V{USART}.}}
\L{\LB{}\Tab{2}{\V{x}++;}\Tab{44}{//_\V{Increment}_\V{byte}_\V{counter}.}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\K{if}_(\V{x}_\>_\N{3})_\{}\Tab{16}{//_\V{All}_\V{packets}_\V{we}_\V{care}_\V{about}_\V{must}_\V{be}_\V{at}_\V{least}_\N{4}_\V{bytes}_\K{long}.}}
\L{\LB{}\Tab{4}{\K{if}_(\V{read\_buffer}[\V{x}\-\N{4}]_==_\N{0xB2})\{}\Tab{36}{//_\V{Check}_\K{for}_\V{a}_\V{sensor}_\V{information}_\V{packet}.}}
\L{\LB{}\Tab{6}{\V{in1}_=_\V{read\_buffer}[\V{x}\-\N{3}];}\Tab{36}{//_\V{Get}_\V{other}_\V{packet}_\V{info}}}
\L{\LB{}\Tab{6}{\V{in2}_=_\V{read\_buffer}[\V{x}\-\N{2}];}}
\L{\LB{}\Tab{6}{//\V{check\_sum}_\V{is}_\V{read\_buffer}[\V{x}\-\N{1}]_\-\-_\V{TODO}:_\V{Add}_\V{code}_\V{to}_\V{check}_\V{this}.}}
\L{\LB{}}
\L{\LB{}\Tab{6}{//_\V{IN1}_=_\<\N{0},_\V{A6},_\V{A5},_\V{A4},_\-_\V{A3},_\V{A2},_\V{A1},_\V{A0}\>}}
\L{\LB{}\Tab{6}{//_\V{IN2}_=_\<\N{0},}\Tab{20}{\V{X},}\Tab{24}{\V{I},_\V{L},_\-_\V{A10},_\V{A9},_\V{A8},_\V{A7}\>}}
\L{\LB{}\Tab{6}{}}
\L{\LB{}\Tab{6}{\C{}/*_Code_for_reading_sensor_data_from_Zach_Burlingame_*/\CE{}}}
\L{\LB{}\Tab{6}{//_\V{Sensor}_\V{num}_=_\<\N{0},_\N{0},_\N{0},_\N{0},_\-_\V{A10},_\V{A9},_\V{A8},_\V{A7},_\-_\V{A6},_\V{A5},_\V{A4},_\V{A3},_\-_\V{A2},_\V{A1},_\V{A0},_\V{I}\>}}
\L{\LB{}\Tab{6}{\V{object\_id}_=_(_((_(_(\V{in2}_\&_\N{0x0F})\<\<\N{7})+(\V{in1}_\&_\N{0x7F})_)\<\<\N{1})_+_(_(_\V{in2}_\&_\N{0x20})_\>\>_\N{5})_)_;}}
\L{\LB{}\Tab{6}{}}
\L{\LB{}\Tab{6}{//_\V{State}_=_\<\N{0},_\N{0},_\N{0},_\V{L}\>}}
\L{\LB{}\Tab{6}{//_\V{L}_=_\N{0}_\-\!\>_\V{no}_\V{train},_\N{1}_\-\!\>_\V{train}_\V{tripped}_\V{sensor}}}
\L{\LB{}\Tab{6}{\V{object\_state}_=_((\V{in2}_\&_\N{0x10})_\>\>_\N{4});}}
\L{\LB{}\Tab{6}{}}
\L{\LB{}\Tab{6}{\V{update\_sensor}(\V{object\_id},_\V{object\_state});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{x}=\N{0};}\Tab{12}{//_\V{Reset}_\V{byte}_\V{counter}.}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}\Tab{4}{}}
\L{\LB{}\Tab{4}{\K{if}_(\V{read\_buffer}[\V{x}\-\N{4}]_==_\N{0xB0})_\{_//_\V{Check}_\K{for}_\V{a}_\V{packet}_\V{that}_\V{is}_\V{setting}_\V{a}_\K{switch}.}}
\L{\LB{}\Tab{6}{\C{}/*}}
\L{\LB{}\Tab{7}{Here,_we_attempted_to_disable_interrupts_for_a_short_period_because_setting}}
\L{\LB{}\Tab{7}{switches_also_sets_off_spurious_sensor_data.}}
\L{\LB{}\Tab{6}{}}
\L{\LB{}\Tab{7}{//_Disable_interrupts.}}
\L{\LB{}\Tab{7}{usart-\!\>usart\_base-\!\>US\_IER_=_0;}}
\L{\LB{}\Tab{7}{usart-\!\>usart\_base-\!\>US\_IDR_=_US\_RXRDY\|US\_TXRDY\|US\_RXBRK\|US\_ENDRX\|US\_ENDTX\|US\_OVRE\|US\_FRAME\|US\_PARE\|US\_TIMEOUT\|US\_TXEMPTY;}}
\L{\LB{}}
\L{\LB{}\Tab{7}{HAL\_DISABLE\_INTERRUPTS(save);}}
\L{\LB{}\Tab{7}{*/\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{6}{//_\V{IN1}_=_\<\N{0},_\V{A6},_\V{A5},_\V{A4},_\-_\V{A3},_\V{A2},_\V{A1},_\V{A0}\>}}
\L{\LB{}\Tab{6}{//_\V{IN2}_=_\<\N{0},}\Tab{20}{\N{0},\V{DIR},_\V{ON},_\-_\V{A10},_\V{A9},_\V{A8},_\V{A7}\>}}
\L{\LB{}\Tab{6}{\V{in1}_=_\V{read\_buffer}[\V{x}\-\N{3}];}}
\L{\LB{}\Tab{6}{\V{in2}_=_\V{read\_buffer}[\V{x}\-\N{2}];}}
\L{\LB{}}
\L{\LB{}\Tab{6}{//_\N{12}_\V{switches},_\V{thus}_\V{highest}_\K{switch}_\V{number}_\V{is}_\N{11},_\V{only}_\V{use}_\V{A3}\-\V{A0}}}
\L{\LB{}\Tab{6}{\V{object\_id}_=_(\V{in1}_\&_\N{0x0F});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{//_\V{state}_=_\<\N{0},_\N{0}_,\N{0}_,_\V{DIR}\>}}
\L{\LB{}\Tab{6}{//_\V{DIR}_=_\N{1}_\-\!\>_\V{closed},_\N{0}_\-\!\>_\V{thrown}/\V{open}}}
\L{\LB{}\Tab{6}{\V{object\_state}_=_((\V{in2}_\&_\N{0x20})_\>\>_\N{5});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{update\_switch}(\V{object\_id},_\V{object\_state});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}/*}}
\L{\LB{}\Tab{7}{Here_is_the_delay_for_debouncing_should_be,_if_interrupts_can}}
\L{\LB{}\Tab{7}{be_disabled:}}
\L{\LB{}\Tab{7}{}}
\L{\LB{}\Tab{7}{for_(i=0;_i\<10;_i++)}}
\L{\LB{}\Tab{9}{hal\_delay\_us(50000);}}
\L{\LB{}}
\L{\LB{}\Tab{7}{//_Reset_interrupts.}}
\L{\LB{}\Tab{7}{usart-\!\>usart\_base-\!\>US\_IDR_=_0;}}
\L{\LB{}\Tab{7}{usart-\!\>usart\_base-\!\>US\_IER_=_US\_RXRDY;}}
\L{\LB{}}
\L{\LB{}\Tab{7}{HAL\_RESTORE\_INTERRUPTS(save);}}
\L{\LB{}}
\L{\LB{}\Tab{7}{HAL\_ENABLE\_INTERRUPTS();}}
\L{\LB{}\Tab{7}{timer-\!\>tc\_base-\!\>TC\_IER_=_TC\_CPCS;}}
\L{\LB{}\Tab{7}{at91\_tc\_trig\_cmd(timer,TC\_TRIG\_CHANNEL);}}
\L{\LB{}\Tab{7}{usart-\!\>usart\_base-\!\>US\_IER_=_US\_RXRDY;//US\_MASK\_IRQ\_RX;}}
\L{\LB{}\Tab{7}{*/\CE{}}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{x}=\N{0};}\Tab{12}{//_\V{Reset}_\V{byte}_\V{counter}.}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}\Tab{4}{}}
\L{\LB{}\Tab{4}{\K{if}_(\V{read\_buffer}[\V{x}\-\N{4}]_==_\N{0xA1})_\{_//_\V{Check}_\K{for}_\V{a}_\V{packet}_\V{changing}_\V{the}_\V{direction}_\V{of}_\V{a}_\V{train}}}
\L{\LB{}\Tab{6}{//_\V{IN1}_=_\<\V{SLOT}\K{\#}\>}}
\L{\LB{}\Tab{6}{//_\V{IN2}_=_\<\N{0},_\N{0},_\V{DIR},_\V{LIG},_\V{F4},_\V{F3},_\V{F2},_\V{F1}\>}}
\L{\LB{}\Tab{6}{\V{in1}_=_\V{read\_buffer}[\V{x}\-\N{3}];}}
\L{\LB{}\Tab{6}{\V{in2}_=_\V{read\_buffer}[\V{x}\-\N{2}];}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{object\_id}_=_\V{in1};}\Tab{24}{//_\V{Identify}_\V{train}.}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\C{}/*}}
\L{\LB{}\Tab{7}{According_to_the_spec,_1_-\!\>_forward,_0_-\!\>_backward}}
\L{\LB{}\Tab{6}{}}
\L{\LB{}\Tab{7}{NOTE:_The_LocoNet_spec_seems_to_be_wrong,_hence_the}}
\L{\LB{}\Tab{7}{negation_of_the_bit_for_update\_train(){'}s_sake.}}
\L{\LB{}\Tab{7}{*/\CE{}}}
\L{\LB{}\Tab{6}{\V{object\_state}_=_!((\V{in2}_\&_\N{0x20})_\>\>_\N{5});}}
\L{\LB{}\Tab{6}{}}
\L{\LB{}\Tab{6}{\V{update\_train}(\V{object\_id},_\V{object\_state});}}
\L{\LB{}}
\L{\LB{}\Tab{6}{\V{x}=\N{0};}\Tab{12}{//_\V{Reset}_\V{byte}_\V{counter}.}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_acknowledge}(\V{vector});}}
\L{\LB{}\Tab{2}{\K{return}(\V{CYG\_ISR\_HANDLED});}}
\L{\LB{\}}}
\L{\LB{}}
\index{output\_train\_location}\Proc{output\_train\_location}\L{\LB{\V{cyg\_uint32}_\V{output\_train\_location}(_\V{cyg\_vector\_t}_\V{vector},_\V{cyg\_addrword\_t}_\V{data}_)_\{}}
\L{\LB{}\Tab{2}{\C{}/*}}
\L{\LB{}\Tab{3}{Interrupt_service_routine_for_the_timer._Every_half-second,_all}}
\L{\LB{}\Tab{3}{of_the_train_slots,_directions,_and_locations_are_outputted.}}
\L{\LB{}\Tab{3}{*/\CE{}}}
\L{\LB{}\Tab{2}{\V{TCDesc}_*\V{timer}_=_\&(\V{TC3\_DESC});}}
\L{\LB{}\Tab{2}{\K{int}_\V{i};}}
\L{\LB{}\Tab{3}{}}
\L{\LB{}\Tab{2}{\K{for}(_\V{i}=\N{0};_\V{i}\<\V{num\_trains};_\V{i}++)_\{}\Tab{34}{//_\V{Print}_\V{info}_\K{for}_\V{each}_\V{of}_\V{the}_\V{trains}.}}
\L{\LB{}\Tab{4}{\V{diag\_printf}(\S{}\3Train_\%d_is_at_\3\SE{},_\V{TrainArray}[\V{i}].\V{slot});}}
\L{\LB{}\Tab{4}{\K{if}(\V{TrainArray}[\V{i}].\V{sensor\_block})_\V{diag\_printf}(\S{}\3block_\3\SE{});}}
\L{\LB{}\Tab{4}{\K{else}_\V{diag\_printf}(\S{}\3sensor_\3\SE{});}}
\L{\LB{}\Tab{4}{\V{diag\_printf}(\S{}\3\%d_going_\3\SE{},_\V{TrainArray}[\V{i}].\V{location});}}
\L{\LB{}\Tab{4}{\K{if}(\V{going\_clockwise}(\&\V{TrainArray}[\V{i}]))_\V{diag\_printf}(\S{}\3clockwise\2n\3\SE{});}}
\L{\LB{}\Tab{4}{\K{else}_\V{diag\_printf}(\S{}\3counterclockwise\2n\3\SE{});}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}\Tab{2}{\V{diag\_printf}(\S{}\3\2n\3\SE{});}}
\L{\LB{}\Tab{3}{}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_acknowledge}(\V{vector});}}
\L{\LB{}\Tab{2}{\V{at91\_tc\_get\_status}(\V{timer});}\Tab{30}{//_\V{Reset}_\V{timer}.}}
\L{\LB{}\Tab{2}{\K{return}(\V{CYG\_ISR\_HANDLED});}}
\L{\LB{\}}}
\L{\LB{}}
\index{init\_timer}\Proc{init\_timer}\L{\LB{\K{void}_\V{init\_timer}(_\K{void}_)_\{}}
\L{\LB{}\Tab{2}{\C{}/*}}
\L{\LB{}\Tab{3}{Initializes_the_timer_to_run_every_half-second.}}
\L{\LB{}\Tab{3}{*/\CE{}}}
\L{\LB{}\Tab{2}{\V{TCDesc}_*\V{timer}_=_\&(\V{TC3\_DESC});}}
\L{\LB{}\Tab{2}{\V{u\_int}_\V{timer\_regs}[\N{4}];}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\V{diag\_printf}(\S{}\3Setting_up_timer.\,.\,.\2n\3\SE{});}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{timer\_counter}_=_\N{32000000}_\>\>_\N{11};}}
\L{\LB{}\Tab{2}{\K{if}_(\V{timer\_counter}_\>=_(\N{1}\<\<\N{16}))_\{}}
\L{\LB{}\Tab{4}{\V{diag\_printf}(\S{}\3Timer_value_(\%d)_too_large!\2n\3\SE{},\V{timer\_counter});}}
\L{\LB{}\Tab{4}{\K{return};}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\V{clock\_select}_=_\V{TC\_CLKS\_MCK1024};}}
\L{\LB{}\Tab{2}{\V{timer\_regs}[\V{RA}]_=_\N{0};}}
\L{\LB{}\Tab{2}{\V{timer\_regs}[\V{RB}]_=_\V{timer\_counter};}}
\L{\LB{}\Tab{2}{\V{timer\_regs}[\V{RC}]_=_\V{timer\_counter};}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{at91\_tc\_open}(\V{timer},\V{TC\_WAVE}_\|_\V{TC\_CPCTRG},\V{FALSE},\V{FALSE});}}
\L{\LB{}\Tab{2}{\V{at91\_tc\_set\_mode}(\V{timer},\V{clock\_select},\N{1});}}
\L{\LB{}\Tab{2}{\V{at91\_tc\_write}(\V{timer},\V{timer\_regs});}}
\L{\LB{}\Tab{4}{}}
\L{\LB{}\Tab{2}{\V{diag\_printf}(\S{}\3Finished_setting_up_timer\2n\3\SE{});}}
\L{\LB{\}}}
\L{\LB{}}
\index{init\_usart}\Proc{init\_usart}\L{\LB{\K{void}_\V{init\_usart}(_\K{void}_)_\{}}
\L{\LB{}\Tab{2}{\C{}/*}}
\L{\LB{}\Tab{3}{Initializes_the_usart_for_LocoNet_reading.}}
\L{\LB{}\Tab{3}{*/\CE{}}}
\L{\LB{}\Tab{2}{\V{UsartDesc}_*\V{usart}_=_\&(\V{USART1\_DESC});}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{diag\_printf}(\S{}\3Setting_up_USART.\,.\,.\2n\3\SE{});}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\C{}/*}}
\L{\LB{}\Tab{3}{set_up_USART_for_1_start,_8_data,_and_1_stop_bit_with_no_parity_check}}
\L{\LB{}\Tab{3}{clock_calculation:_32M_/_8_/_16457k_=_15}}
\L{\LB{}\Tab{3}{*/\CE{}}}
\L{\LB{}\Tab{2}{\V{at91\_usart\_open}(\V{usart},_\V{US\_CLKS\_MCK8}_\|_\V{US\_CHRL\_8}_\|_\V{US\_PAR\_NO}_\|_\V{US\_NBSTOP\_1}_\|_\V{US\_CHMODE\_NORMAL},_\N{15},_\N{0});}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{diag\_printf}(\S{}\3Finished_setting_up_USART\2n\3\SE{});}}
\L{\LB{\}}}
\L{\LB{}}
\index{init\_interrupts}\Proc{init\_interrupts}\L{\LB{\K{void}_\V{init\_interrupts}(_\K{void}_)_\{}}
\L{\LB{}\Tab{2}{\C{}/*}}
\L{\LB{}\Tab{3}{Initialize_the_interrupts_for_the_timer_and_usart.}}
\L{\LB{}\Tab{3}{*/\CE{}}}
\L{\LB{}\Tab{2}{\V{TCDesc}_*\V{timer}_=_\&(\V{TC3\_DESC});}}
\L{\LB{}\Tab{2}{\V{cyg\_interrupt}_\V{tc\_interrupt\_info};}}
\L{\LB{}\Tab{2}{\V{cyg\_handle\_t}_\V{tc\_handle};}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{UsartDesc}_*\V{usart}_=_\&(\V{USART1\_DESC});}}
\L{\LB{}\Tab{2}{\V{cyg\_interrupt}_\V{uc\_interrupt\_info};}}
\L{\LB{}\Tab{2}{\V{cyg\_handle\_t}_\V{uc\_handle};}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{diag\_printf}(\S{}\3Setting_up_interrupts.\,.\,.\2n\3\SE{});}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{//_\V{timer}}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_create}(\N{9},\N{7},\V{NULL},\V{output\_train\_location},\V{NULL},\&\V{tc\_handle},\&\V{tc\_interrupt\_info});}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_attach}(\V{tc\_handle});}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_configure}(\N{9},\V{false},\V{false});}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_unmask}(\N{9});}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{//_\V{usart1}}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_create}(\N{3},\N{7},\V{NULL},\V{usart\_read},\V{NULL},\&\V{uc\_handle},\&\V{uc\_interrupt\_info});}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_attach}(\V{uc\_handle});}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_configure}(\N{3},\V{false},\V{false});}}
\L{\LB{}\Tab{2}{\V{cyg\_drv\_interrupt\_unmask}(\N{3});}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{diag\_printf}(\S{}\3Finished_setting_up_interrupts\2n\3\SE{});}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{HAL\_ENABLE\_INTERRUPTS}();}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\V{timer}\-\!\>\V{tc\_base}\-\!\>\V{TC\_IER}_=_\V{TC\_CPCS};}}
\L{\LB{}\Tab{2}{\V{at91\_tc\_trig\_cmd}(\V{timer},\V{TC\_TRIG\_CHANNEL});}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\V{usart}\-\!\>\V{usart\_base}\-\!\>\V{US\_IER}_=_\V{US\_RXRDY};}}
\L{\LB{\}}}
\L{\LB{}}
\index{cyg\_user\_start}\Proc{cyg\_user\_start}\L{\LB{\K{void}_\V{cyg\_user\_start}(_\K{void}_)_\{}}
\L{\LB{}\Tab{2}{\V{init\_timer}();}}
\L{\LB{}\Tab{2}{\V{init\_usart}();}}
\L{\LB{}\Tab{2}{\V{init\_trains}();}}
\L{\LB{}\Tab{2}{\V{init\_interrupts}();}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{//_\V{put}_\V{the}_\V{system}_\V{in}_\V{idle}_\V{mode}_\V{permanently}}}
\L{\LB{}\Tab{2}{\K{for}_(;;)_\{}}
\L{\LB{}\Tab{4}{\V{at91\_clock\_set\_mode}(\V{PS\_MODE\_IDLE});}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\K{return};}}
\L{\LB{\}}}
